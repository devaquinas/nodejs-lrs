Server = require '../../../app/server'
config = require '../../../app/config'
request = require 'supertest'
assert = require 'assert'

dbController = null
dbCounter = 0

beforeEach (done) ->
  @timeout 4000
  configClone = JSON.parse JSON.stringify config
  configClone.server.port = false
  configClone.database.name = "nodejs-lrs-test-#{dbCounter++}"
  configClone.database.reset = true

  new Server configClone, (err, server) ->
    module.exports.request = request server.getRestifyServer()
    dbController = server.dbController
    done err

afterEach (done) ->
  dbController.deleteDB done