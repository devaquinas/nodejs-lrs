Server = require '../../../app/server'
config = require '../../../app/config'
request = require 'supertest'
assert = require 'assert'

dbCounter = 0
server = null

module.exports.prepareTest = (callback) ->
  configClone = JSON.parse JSON.stringify config
  configClone.server.port = false
  configClone.database.name = 'nodejs-lrs-test-' + dbCounter++
  configClone.database.reset = true
  server = new Server configClone, (err, server) ->
    callback err, request server.getRestifyServer()

beforeEach (done) ->
  require('setup_test_env').prepareTest (err, req) ->
    module.exports.testRequest = req
    done err
    
afterEach ->
    server.tearDown((->))