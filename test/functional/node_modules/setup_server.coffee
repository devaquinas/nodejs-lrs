Server = require '../../../app/server.coffee'
config = require '../../../app/config.coffee'
request = require 'supertest'

dbCounter = 0

module.exports.prepareTest = (callback) ->
  configClone = JSON.parse JSON.stringify config
  configClone.server.port = false
  configClone.database.name = 'nodejs-lrs-test-' + dbCounter++
  configClone.database.reset = true
  new Server configClone, (server) ->
    callback request server.getRestifyServer()